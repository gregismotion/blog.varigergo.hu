async function getCatalog(){return await(await fetch("/catalog.json")).json()}function getCart(){return JSON.parse(localStorage.getItem("cart"))||{}}function isCartEmpty(){return Object.keys(getCart()).length==0}function setCart(e){window.dispatchEvent(new Event("cartChange")),localStorage.setItem("cart",JSON.stringify(e))}async function addToCart(e){changeQuantity(e,1)}function clearCart(){localStorage.removeItem("cart")}async function changeQuantity(e,t){var n,s=await getCatalog();e in s&&(n=await getCart(),n[e]?n[e].quantity+t>0&&(n[e].quantity+t<=s[e].maxAmount||!s[e].maxAmount)?n[e].quantity+=t:n[e].quantity+t<=0&&delete n[e]:t>0&&(n[e]={quantity:t}),setCart(n))}function addBumps(e,t,n){n.forEach(n=>{if(n in e){var s,o,i,a=document.getElementById("cart-bumps");a!=null&&(s=document.createElement("div"),s.classList.add("cart-bump"),o=n in t,o&&(o=t[n].quantity>0),s.innerHTML+='<input class="bump-check" data-id="'+n+'" type="checkbox">',s.innerHTML+="<strong>"+e[n].name+"</strong>",i=e[n].price,"discountedPrice"in e[n]&&(i=e[n].discountedPrice,s.innerHTML+='<span class="strikethrough">'+formatPrice(e[key].price)+"</span> "),s.innerHTML+=" "+formatPrice(i),s.innerHTML+="<br /><small>"+e[n].description+"</small>",a.appendChild(s),document.querySelector(".bump-check[data-id="+n+"]").checked=o)}})}async function displayCart(){var e,n,s,o,i,a,c,l,u,t=await getCatalog(),r=document.getElementById("cart-items"),d=document.getElementById("cart-bumps");if(d!=null&&(d.innerHTML=""),r!=null){r.innerHTML="",c=0,a=0,o=JSON.parse(localStorage.getItem("cart"))||{};for(e in o)Object.hasOwn(o,e)&&(n=o[e],e in t&&n.quantity>0&&(s=document.createElement("div"),s.classList.add("cart-item"),s.innerHTML="<strong>"+t[e].name+'</strong><br/> <p class="cart-action" id="quantity-minus" data-id="'+e+'">-</p> '+n.quantity+' <p class="cart-action" id="quantity-plus" data-id="'+e+'">+</p>  x ',i=t[e].price,"discountedPrice"in t[e]&&(i=t[e].discountedPrice,s.innerHTML+='<span class="strikethrough">'+formatPrice(t[e].price)+"</span> "),s.innerHTML+=formatPrice(i)+" = <strong>"+formatPrice(n.quantity*i)+"</strong>",r.appendChild(s),c+=n.quantity*i,a+=n.quantity*t[e].price,t[e].bumps&&addBumps(t,o,t[e].bumps)));a!=l&&(u=document.getElementById("real-price"),u.innerHTML=formatPrice(a)),l=document.getElementById("final-price"),l.innerHTML=formatPrice(c),document.querySelectorAll("#quantity-minus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),-1),displayCart()})}),document.querySelectorAll("#quantity-plus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),+1),displayCart()})}),document.querySelectorAll(".bump-check").forEach(e=>{e.addEventListener("change",function(){changeQuantity(e.getAttribute("data-id"),this.checked?1:-1),displayCart()})})}else console.log("displayCart: Can't display cart, no container.")}function setupPaymentClear(){var e=document.getElementById("payment-form");e?e.addEventListener("submit",clearCart):console.log("on DOMContentLoaded: no payment-form, probably not on checkout.")}function formatPrice(e){var t=new Intl.NumberFormat("hu-HU",{style:"currency",currency:"HUF",minimumFractionDigits:0});return t.format(e)}async function setupBuyButtons(){document.querySelectorAll(".buy").forEach(e=>{e.addEventListener("click",function(){addToCart(e.dataset.id)})});var e=await getCatalog();document.querySelectorAll("#origPrice").forEach(t=>{var n=t.getAttribute("data-id");n in e&&(price=e[n].price,t.innerHTML=formatPrice(price))}),document.querySelectorAll("#price").forEach(t=>{var n=t.getAttribute("data-id");n in e&&e[n].discountedPrice&&(document.querySelectorAll("#origPrice").forEach(e=>{var t=e.getAttribute("data-id");e.classList.add("strikethrough")}),price=e[n].discountedPrice,t.innerHTML=formatPrice(price))}),document.querySelectorAll("#discountPercentage").forEach(t=>{var n=t.getAttribute("data-id");n in e&&e[n].discountedPrice&&(percentage=Math.round((1-e[n].discountedPrice/e[n].price)*100),t.innerHTML=percentage+"%")}),document.querySelectorAll(".stack-total").forEach(e=>{var t=0,n=e.getAttribute("data-id");Array.from(document.querySelector(".stack-offer ul").children).forEach(e=>{t+=parseInt(e.querySelector(".priceShow").innerHTML)}),e.innerHTML=formatPrice(t)}),document.querySelectorAll(".priceShow").forEach(e=>{e.innerHTML=formatPrice(e.innerHTML)}),isCartEmpty()||document.querySelectorAll(".finish-cart").forEach(e=>{e.parentElement.style.display="block"})}document.addEventListener("DOMContentLoaded",displayCart),document.addEventListener("DOMContentLoaded",function(){setupPaymentClear(),setupBuyButtons()})