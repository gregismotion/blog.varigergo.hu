async function getCatalog(){return await(await fetch("/catalog.json")).json()}function getCart(){return JSON.parse(localStorage.getItem("cart"))||{}}function setCart(e){localStorage.setItem("cart",JSON.stringify(e))}async function addToCart(e){changeQuantity(e,1)}function clearCart(){localStorage.removeItem("cart")}async function changeQuantity(e,t){var n,s=await getCatalog();e in s&&(n=await getCart(),n[e]?n[e].quantity+t>=0&&(n[e].quantity+t<=s[e].maxAmount||!s[e].maxAmount)&&(n[e].quantity+=t):n[e]={quantity:t},setCart(n))}async function displayCart(){var e,n,s,o,i,a,r,l,d,u,t=await getCatalog(),c=document.getElementById("cart-items");if(c!=null){c.innerHTML="",n=new Intl.NumberFormat("hu-HU",{style:"currency",currency:"HUF",minimumFractionDigits:0}),l=0,a=0,r=JSON.parse(localStorage.getItem("cart"))||{};for(e in r)Object.hasOwn(r,e)&&(s=r[e],e in t&&s.quantity>0&&(o=document.createElement("div"),o.classList.add("cart-item"),o.innerHTML="<strong>"+t[e].name+'</strong><br/> <p class="cart-action" id="quantity-minus" data-id="'+e+'">-</p> '+s.quantity+' <p class="cart-action" id="quantity-plus" data-id="'+e+'">+</p>  x ',i=t[e].price,"discountedPrice"in t[e]&&(i=t[e].discountedPrice,o.innerHTML+='<span class="strikethrough">'+n.format(t[e].price)+"</span> "),o.innerHTML+=n.format(i)+" = <strong>"+n.format(s.quantity*i)+"</strong>",c.appendChild(o),l+=s.quantity*i,a+=s.quantity*t[e].price));a!=d&&(u=document.getElementById("real-price"),u.innerHTML=n.format(a)),d=document.getElementById("final-price"),d.innerHTML=n.format(l),document.querySelectorAll("#quantity-minus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),-1),displayCart()})}),document.querySelectorAll("#quantity-plus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),+1),displayCart()})})}else console.log("displayCart: Can't display cart, no container.")}function setupPaymentClear(){var e=document.getElementById("payment-form");e?e.addEventListener("submit",clearCart):console.log("on DOMContentLoaded: no payment-form, probably not on checkout.")}async function setupBuyButtons(){document.querySelectorAll(".buy").forEach(e=>{e.addEventListener("click",function(){addToCart(e.dataset.id)})});var e=await getCatalog();document.querySelectorAll("#origPrice").forEach(t=>{var n=t.getAttribute("data-id");n in e&&(price=e[n].price,t.innerHTML=price)}),document.querySelectorAll("#price").forEach(t=>{var n=t.getAttribute("data-id");n in e&&(price=e[n].discountedPrice,t.innerHTML=price)}),document.querySelectorAll("#discountPercentage").forEach(t=>{var n=t.getAttribute("data-id");n in e&&(percentage=Math.round(e[n].discountedPrice/e[n].price*100),t.innerHTML=percentage)})}window.addEventListener("DOMContentLoaded",displayCart),window.addEventListener("DOMContentLoaded",function(){setupPaymentClear(),setupBuyButtons()})