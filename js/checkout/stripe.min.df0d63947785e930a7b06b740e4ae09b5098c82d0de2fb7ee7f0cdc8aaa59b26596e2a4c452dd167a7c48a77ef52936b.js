const stripe=Stripe(document.currentScript.getAttribute("data-key")),backendUrl=document.currentScript.getAttribute("data-backend"),doneUrl=document.currentScript.getAttribute("data-done");let elements;initialize(),checkStatus(),document.querySelector("#payment-form").addEventListener("submit",handleSubmit);async function getCatalog(){return await(await fetch("/catalog.json")).json()}function getCartString(){return localStorage.getItem("cart")}let emailAddress="";async function initialize(){const t=await fetch(backendUrl+"/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:getCartString()}),{clientSecret:n}=await t.json(),s={theme:"none",variables:{colorPrimary:"#f2e900",colorBackground:"black",colorText:"#02d7f2",colorTextPlaceholder:"#02d7f2",colorBackgroundText:"#02d7f2",spacingUnit:"5px",spacingGridRow:"50px"},rules:{".Input":{borderBottom:"2px solid #02d7f2"},".Input:focus":{borderBottom:"2px solid #f2e900",color:"#f2e900"},".Label--floating":{color:"#f2e900"}},labels:"floating"};elements=stripe.elements({appearance:s,clientSecret:n,locale:"hu"});const e=elements.create("linkAuthentication");e.mount("#link-authentication-element"),e.on("change",e=>{emailAddress=e.value.email});const o={layout:"tabs"},i=elements.create("payment",o);i.mount("#payment-element")}async function handleSubmit(e){e.preventDefault(),setLoading(!0);const{error:t}=await stripe.confirmPayment({elements,confirmParams:{return_url:doneUrl,receipt_email:emailAddress}});showMessage(t.type==="card_error"||t.type==="validation_error"?t.message:"An unexpected error occurred."),setLoading(!1)}async function checkStatus(){const e=new URLSearchParams(window.location.search).get("payment_intent_client_secret");if(!e)return;const{paymentIntent:t}=await stripe.retrievePaymentIntent(e);switch(t.status){case"succeeded":showMessage("Payment succeeded!");break;case"processing":showMessage("Your payment is processing.");break;case"requires_payment_method":showMessage("Your payment was not successful, please try again.");break;default:showMessage("Something went wrong.");break}}function showMessage(e){const t=document.querySelector("#payment-message");t.classList.remove("hidden"),t.textContent=e,setTimeout(function(){t.classList.add("hidden"),e.textContent=""},4e3)}function setLoading(e){e?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}